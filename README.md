# Google Fonts Proxy

üöÄ **–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–∫—Ä–∏–ø—Ç –¥–ª—è Google Fonts —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ PHP-—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Google Fonts –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–º–µ–Ω–æ–π –ø—É—Ç–µ–π –≤ CSS —Ñ–∞–π–ª–∞—Ö. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞ –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **‚ö° –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞
- **üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - CSS –∏ —à—Ä–∏—Ñ—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ 1 –≥–æ–¥
- **üîí –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** - –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Google —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
- **üåê CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- **üì± –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞** - WOFF2 –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤, WOFF –¥–ª—è —Å—Ç–∞—Ä—ã—Ö
- **üõ°Ô∏è –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π
- **üíæ –ö—ç—à –≤ –ø–∞–º—è—Ç–∏** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º
- **üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **üéØ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è User-Agent** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
- **üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫—ç—à–∞

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4 –∏–ª–∏ –≤—ã—à–µ
- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è: `curl` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ `allow_url_fopen`
- –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
- SSL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:**
   ```bash
   wget https://raw.githubusercontent.com/commeta/google-fonts-proxy/main/fonts-proxy.php
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   ```bash
   chmod 755 fonts-proxy.php
   ```

3. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PHP –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
   ```bash
   chown www-data:www-data /path/to/script/directory
   ```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
- `cache/css/` - –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è CSS —Ñ–∞–π–ª–æ–≤
- `cache/fonts/` - –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —à—Ä–∏—Ñ—Ç–æ–≤

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ Google Fonts:

**–ë—ã–ª–æ:**
```html
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700&display=swap" rel="stylesheet">
```

**–°—Ç–∞–ª–æ:**
```html
<link href="https://yourdomain.com/fonts-proxy.php?family=Open+Sans:400,600,700&display=swap" rel="stylesheet">
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- `family` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å—Ç–∏–ª–∏ —à—Ä–∏—Ñ—Ç–∞
- `subset` - —è–∑—ã–∫–æ–≤—ã–µ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞
- `display` - —Å–≤–æ–π—Å—Ç–≤–æ font-display
- `text` - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**V1 API**
```html
<!-- –û–¥–∏–Ω —à—Ä–∏—Ñ—Ç -->
<link href="/fonts-proxy.php?family=Roboto:400,700" rel="stylesheet">

<!-- –ù–µ—Å–∫–æ–ª—å–∫–æ —à—Ä–∏—Ñ—Ç–æ–≤ -->
<link href="/fonts-proxy.php?family=Roboto:400,700|Open+Sans:300,400" rel="stylesheet">

<!-- –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ -->
<link href="/fonts-proxy.php?family=Roboto:400&display=swap&subset=latin,cyrillic" rel="stylesheet">
```

**V2 API**
```html
<!-- 1) –ë–∞–∑–æ–≤—ã–π v2: –≤–µ—Å —á–µ—Ä–µ–∑ wght@ -->
<link href="/fonts-proxy.php?family=Roboto:wght@400;700" rel="stylesheet">

<!-- 2) Italic + weight: ital,wght@0,400;1,700 -->
<link href="/fonts-proxy.php?family=Open+Sans:ital,wght@0,300;0,400;1,400;1,700" rel="stylesheet">

<!-- 3) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã (variable font) —Å –æ—Å—è–º–∏ -->
<link href="/fonts-proxy.php?family=Roboto+Flex:opsz,wght@8..144,100..900" rel="stylesheet">

<!-- 4) –° display, —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∏ subset -->
<link href="/fonts-proxy.php?family=Montserrat:wght@400;600&display=swap&text=Hello%20World!&subset=latin-ext" rel="stylesheet">

<!-- 5) –ú—É–ª—å—Ç—è—à—Ä–∏—Ñ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ v2 -->
<link href="/fonts-proxy.php?family=Roboto+Slab:wght@300;600&family=Lato:ital,wght@0,400;1,700&display=swap" rel="stylesheet">
```

## üõ†Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

```bash
curl "https://yourdomain.com/fonts-proxy.php?action=clear_cache"
```

–û—Ç–≤–µ—Ç:
```
Cache cleared. Files removed: 25
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
curl "https://yourdomain.com/fonts-proxy.php?action=debug_performance"
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
    "memory_cache_size": 3,
    "memory_usage": 2097152,
    "memory_peak": 2097152,
    "cache_dir_exists": true,
    "fonts_dir_exists": true,
    "css_cache_files": 1,
    "font_cache_files": 63,
    "cache_normalization": "enabled",
    "user_agent_normalized": "Mozilla/5.0 Modern Browser (woff2 support)",
    "detected_font_format": "woff2",
    "cache_stats": {
        "css_files": 1,
        "font_files": 63,
        "total_size": 1814126,
        "cache_efficiency": "improved",
        "api_v2_support": true,
        "total_size_mb": 1.73,
        "cache_hit_ratio": 100
    }
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞

```bash
curl "https://yourdomain.com/fonts-proxy.php?action=cache_stats"
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
    "css_files": 1,
    "font_files": 63,
    "total_size": 1814126,
    "cache_efficiency": "improved",
    "api_v2_support": true,
    "total_size_mb": 1.73,
    "cache_hit_ratio": 100
}
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ñ–∞–π–ª–µ —Å–∫—Ä–∏–ø—Ç–∞:

```php
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø—É—Ç–µ–π
const CACHE_CSS_DIR = 'cache/css/';     // –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∫–µ—à–∞ CSS
const CACHE_FONTS_DIR = 'cache/fonts/'; // –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∫–µ—à–∞ —à—Ä–∏—Ñ—Ç–æ–≤
const FONTS_WEB_PATH = '/cache/fonts/'; // URL-–ø—É—Ç—å –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ CSS
```

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–ª–∞—Å—Å–µ `GoogleFontsProxy`:

```php
private $maxCacheAge = 86400 * 365;   // –í—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (1 –≥–æ–¥)
private $maxExecutionTime = 30;       // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
const LOCK_TIMEOUT = 30;              // –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
const TEMP_FILE_PREFIX = '.tmp_';     // –ü—Ä–µ—Ñ–∏–∫—Å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const LOCK_FILE_PREFIX = '.lock_';    // –ü—Ä–µ—Ñ–∏–∫—Å —Ñ–∞–π–ª–æ–≤-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

#### Apache (.htaccess)
```apache
<Files "fonts-proxy.php">
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤
    <IfModule mod_expires.c>
        ExpiresActive on
        ExpiresByType text/css "access plus 1 year"
    </IfModule>
    
    # –°–∂–∞—Ç–∏–µ
    <IfModule mod_deflate.c>
        SetOutputFilter DEFLATE
    </IfModule>
    
    # ETag –ø–æ–¥–¥–µ—Ä–∂–∫–∞
    <IfModule mod_headers.c>
        Header append Vary User-Agent
        Header append Vary Accept-Language
    </IfModule>
</Files>
```

#### Nginx
```nginx
location ~ ^/fonts-proxy\.php$ {
    fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    fastcgi_index index.php;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    expires 1y;
    add_header Cache-Control "public, max-age=31536000";
    add_header Vary "User-Agent, Accept-Language";
}
```

## üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- **–ö—ç—à –≤ –ø–∞–º—è—Ç–∏** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞** - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `stat()`
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è User-Agent** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
- **–ü–∞–∫–µ—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤** - –µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è** - –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ–¥–∏–Ω —Ä–∞–∑
- **ETag –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ–∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä WOFF2/WOFF

### –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ User-Agent

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é User-Agent –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã** (Chrome, Firefox, Safari, Edge, Opera) ‚Üí –µ–¥–∏–Ω—ã–π –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π UA –¥–ª—è WOFF2
- **–°—Ç–∞—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã** (IE, —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏) ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π UA –¥–ª—è WOFF
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ WOFF2 –ø–æ –≤–µ—Ä—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –¢–µ—Å—Ç —Ö–æ–ª–æ–¥–Ω–æ–≥–æ –∫—ç—à–∞
time curl -s "https://yourdomain.com/fonts-proxy.php?family=Roboto:400,700" > /dev/null

# –¢–µ—Å—Ç –≥–æ—Ä—è—á–µ–≥–æ –∫—ç—à–∞  
time curl -s "https://yourdomain.com/fonts-proxy.php?family=Roboto:400,700" > /dev/null

# –¢–µ—Å—Ç ETag (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 304)
curl -H 'If-None-Match: "–≤–∞—à_etag"' -v "https://yourdomain.com/fonts-proxy.php?family=Roboto:400,700"
```

### –í—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

- **CSS –∏ —à—Ä–∏—Ñ—Ç—ã**: 1 –≥–æ–¥ (365 –¥–Ω–µ–π)
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**: –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫—ç—à**: 1 –≥–æ–¥ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ETag

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
ls -la /path/to/script/

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
chown -R www-data:www-data cache/
chmod -R 755 cache/
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ SSL, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–æ—Ä–Ω–µ–≤—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:
```bash
php -r "var_dump(openssl_get_cert_locations());"
```

### –û—Ç–ª–∞–¥–∫–∞

–í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ PHP:
```php
ini_set('log_errors', 1);
ini_set('error_log', '/path/to/error.log');
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é" | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ |
| "cURL error" | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ php-curl |
| "SSL certificate problem" | –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ—Ä–Ω–µ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã |
| –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–∞ |
| 304 –æ—à–∏–±–∫–∏ | –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ - –±—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à |

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏. –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—à–∏–±–æ–∫
tail -f /var/log/apache2/error.log | grep "Google Fonts Proxy"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
curl -s "https://yourdomain.com/fonts-proxy.php?action=cache_stats" | jq '.'

# –†–∞–∑–º–µ—Ä –∫—ç—à–∞
du -sh cache/

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
find cache/ -type f | wc -l
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∞–π–ª–æ–≤:

```bash
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
0 3 * * 0 /usr/bin/curl -s "https://yourdomain.com/fonts-proxy.php?action=clear_cache" > /dev/null
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –∏ URL
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –∞—Ç–∞–∫
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (500 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π –≤ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö URL
- ‚úÖ Race Condition –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –∫—ç—à–∞


### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

```apache
# –ó–∞—â–∏—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (Apache)
<FilesMatch "fonts-proxy\.php">
    <RequireAll>
        Require local
        # –∏–ª–∏ Require ip 192.168.1.0/24
    </RequireAll>
    SetEnvIf Query_String "action=" admin_access
    <RequireAll>
        Require env admin_access
        Require local
    </RequireAll>
</FilesMatch>
```


## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã Google Fonts Proxy:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞** - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ Google Fonts API
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ CSS** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –ó–∞–ø—Ä–æ—Å –∫ Google Fonts API —á–µ—Ä–µ–∑ cURL –∏–ª–∏ file_get_contents
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤** - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ URL —à—Ä–∏—Ñ—Ç–æ–≤, –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
6. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –ó–∞–º–µ–Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö URL –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤ CSS
7. **–í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** - –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ—Ç–æ–≤–æ–≥–æ CSS —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ —à—Ä–∏—Ñ—Ç–æ–≤** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä WOFF2 –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –∏–ª–∏ WOFF –¥–ª—è —Å—Ç–∞—Ä—ã—Ö
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - Fallback –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∑–∞–≥—Ä—É–∑–∫–æ–π
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞, –æ—Ç–ª–∞–¥–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤

–°–∫—Ä–∏–ø—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Google Fonts –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è GDPR –∏ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞.

```mermaid
graph TB
    Start([–ó–∞–ø—Ä–æ—Å –∫ fonts-proxy.php]) --> CheckAction{–ï—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä action?}
    
    %% –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    CheckAction -->|–î–∞| AdminActions[–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è]
    AdminActions --> ClearCache[clear_cache: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞]
    AdminActions --> DebugPerf[debug_performance: –û—Ç–ª–∞–¥–∫–∞]
    AdminActions --> CacheStats[cache_stats: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]
    ClearCache --> EndAdmin[–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞]
    DebugPerf --> EndAdmin
    CacheStats --> EndAdmin
    
    %% –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
    CheckAction -->|–ù–µ—Ç| Init[–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GoogleFontsProxy]
    Init --> CreateDirs[–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π cache/css/ –∏ cache/fonts/]
    CreateDirs --> ValidateParams[–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ GET]
    ValidateParams --> BuildURL[–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL –¥–ª—è Google Fonts API]
    
    %% –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ API
    BuildURL --> DetectAPI{–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ API}
    DetectAPI -->|v1| APIV1[fonts.googleapis.com/css]
    DetectAPI -->|v2| APIV2[fonts.googleapis.com/css2]
    
    APIV1 --> GenerateKey[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫—ç—à–∞]
    APIV2 --> GenerateKey
    
    %% –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—ç—à–∞ CSS
    GenerateKey --> CheckCSSCache{CSS –≤ –∫—ç—à–µ –∏ –≤–∞–ª–∏–¥–µ–Ω?}
    CheckCSSCache -->|–î–∞| OutputCached[–í—ã–≤–æ–¥ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ CSS]
    CheckCSSCache -->|–ù–µ—Ç| AcquireLock[–ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è CSS]
    
    AcquireLock --> LockSuccess{–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞?}
    LockSuccess -->|–ù–µ—Ç| CheckCacheAgain[–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞]
    CheckCacheAgain --> OutputCached
    
    LockSuccess -->|–î–∞| DoubleCheck[–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞]
    DoubleCheck -->|–ö—ç—à –Ω–∞–π–¥–µ–Ω| OutputCached
    DoubleCheck -->|–ö—ç—à –Ω–µ –Ω–∞–π–¥–µ–Ω| FetchCSS[–ó–∞–ø—Ä–æ—Å CSS –æ—Ç Google]
    
    %% –ü–æ–ª—É—á–µ–Ω–∏–µ CSS –æ—Ç Google
    FetchCSS --> UseCurl{cURL –¥–æ—Å—Ç—É–ø–µ–Ω?}
    UseCurl -->|–î–∞| CurlRequest[HTTP –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ cURL]
    UseCurl -->|–ù–µ—Ç| FileGetContents[HTTP –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ file_get_contents]
    
    CurlRequest --> ProcessCSS[–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ CSS]
    FileGetContents --> ProcessCSS
    
    %% –û–±—Ä–∞–±–æ—Ç–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤
    ProcessCSS --> ExtractFontURLs[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ URL —à—Ä–∏—Ñ—Ç–æ–≤ –∏–∑ CSS]
    ExtractFontURLs --> CheckFonts{–®—Ä–∏—Ñ—Ç—ã –Ω–∞–π–¥–µ–Ω—ã?}
    CheckFonts -->|–ù–µ—Ç| SaveCSS[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ CSS –≤ –∫—ç—à]
    CheckFonts -->|–î–∞| ProcessFonts[–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞]
    
    ProcessFonts --> FontLoop[–¶–∏–∫–ª –ø–æ —à—Ä–∏—Ñ—Ç–∞–º]
    FontLoop --> CheckFontCache{–®—Ä–∏—Ñ—Ç –≤ –∫—ç—à–µ?}
    CheckFontCache -->|–î–∞| NextFont[–°–ª–µ–¥—É—é—â–∏–π —à—Ä–∏—Ñ—Ç]
    CheckFontCache -->|–ù–µ—Ç| FontLock[–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è —à—Ä–∏—Ñ—Ç–∞]
    
    FontLock --> DownloadFont[–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞]
    DownloadFont --> FontFormat{–§–æ—Ä–º–∞—Ç —à—Ä–∏—Ñ—Ç–∞}
    FontFormat --> WOFF2[WOFF2 –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤]
    FontFormat --> WOFF[WOFF –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤]
    
    WOFF2 --> SaveFont[–ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞]
    WOFF --> SaveFont
    SaveFont --> NextFont
    
    NextFont --> AllFontsProcessed{–í—Å–µ —à—Ä–∏—Ñ—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã?}
    AllFontsProcessed -->|–ù–µ—Ç| FontLoop
    AllFontsProcessed -->|–î–∞| ReplaceURLs[–ó–∞–º–µ–Ω–∞ URL –≤ CSS –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ]
    
    ReplaceURLs --> AddMetadata[–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ CSS]
    AddMetadata --> SaveCSS
    SaveCSS --> ReleaseLock[–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏]
    ReleaseLock --> OutputCSS[–í—ã–≤–æ–¥ CSS —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏]
    
    OutputCached --> End([–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ])
    OutputCSS --> End
    EndAdmin --> End
    
    %% –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    ProcessCSS -.->|–û—à–∏–±–∫–∞| HandleError[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏]
    DownloadFont -.->|–û—à–∏–±–∫–∞| HandleError
    HandleError --> FallbackCSS[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Fallback CSS]
    FallbackCSS --> End
    
    %% –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef cache fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef api fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef error fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    
    class Start,End startEnd
    class Init,CreateDirs,ValidateParams,ProcessCSS,ExtractFontURLs,ProcessFonts,ReplaceURLs,AddMetadata,SaveCSS,OutputCSS process
    class CheckAction,DetectAPI,CheckCSSCache,LockSuccess,UseCurl,CheckFonts,CheckFontCache,FontFormat,AllFontsProcessed decision
    class OutputCached,SaveFont,GenerateKey cache
    class APIV1,APIV2,BuildURL,FetchCSS,CurlRequest,FileGetContents api
    class HandleError,FallbackCSS error
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- Google Fonts –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∏—á–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
